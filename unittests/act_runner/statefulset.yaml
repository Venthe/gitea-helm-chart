suite: actions template | statefulset
release:
  name: gitea-unittests
  namespace: testing
templates:
  - templates/gitea/act_runner/statefulset.yaml
tests:
  - it: renders a StatefulSet
    template: templates/gitea/act_runner/statefulset.yaml
    set:
      actions:
        enabled: true
    asserts:
      - hasDocuments:
          count: 1
      - containsDocument:
          kind: StatefulSet
          apiVersion: apps/v1
          name: gitea-unittests-act-runner
      - equal:
          path: spec.template.spec.containers[0].env[3]
          value:
            name: GITEA_RUNNER_REGISTRATION_TOKEN
            valueFrom:
              secretKeyRef:
                name: "gitea-unittests-actions-token"
                key: "token"